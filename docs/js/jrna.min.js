Executing minify lib/jrna.js
const jRna=function(){"use strict";if("undefined"!=typeof window&&("function"!=typeof window.$||void 0===window.document))throw new Error("jRna: refusing to run without a window.$ and window.document");const t=require("./dep/caller-info.js");function n(){const e=this.origin=t(1),i=function(t){throw new Error(t+" - jRna@"+e)};this._known={};for(let t of["appendTo","container","element","id","onAttach","onRemove","remove"])this._known[t]=!0;this.lockName=function(t,n){this._known[t]&&this._known[t]!==n&&i("Property name already in use: "+t),this._known[t]=n||!0};const o={};this.html=function(t){if(void 0!==t){const n=function(t){const n=window.document.createElement("div");return n.setAttribute("style","display: none"),n.innerHTML=t,n.firstChild||i("Attempt to use empty HTML"),1!==n.firstChild.nodeType&&i("Attempt to use non-element as HTML container"),n.firstChild!==n.lastChild&&i("Attempt to create multiple tag HTML"),n.firstChild}(t);this._master=n}else this._master=void 0;return this},this.htmlFrom=function(t){return t=this.checkElement(t,"get HTML from"),this.html(t[0].outerHTML),this};const r={};for(let t in this._known)r[t]=!0;const s={id:!0},u={id:!0};this.addArgument=function(t,n={}){return n.forbidden?(s[t]&&i("Forbidden argument name: "+t),r[t]=!0,this):(r[t]&&i("Forbidden argument name: "+t),s[t]=!0,u[t]=n.assign,this)},this.args=function(...t){for(let n of t)this.addArgument(n,{assign:!0});return this},this._setup=[],this._wanted={},this.setup=function(t,e){return this._setup.push([t,e]),this._wanted[n.prefix+t]=t,this};const c=function(t,n){Array.isArray(n)||(n=[n]);const[e,...o]=n;return"string"==typeof e?function(...n){return t[e].apply(t,o.concat(n))}:o.length&&"function"==typeof e?function(...n){return e.apply(t,o.concat(n))}:"function"==typeof e?e.bind(t):void i("Unexpected callback argument")};this.output=function(t){const[e,i]=n.parseId(t);return this.lockName(i),this.setup(e,(function(t,n){let e;Object.defineProperty(t,i,{get:function(){return e},set:function(t){n.text(e=t)},enumerable:!0})}))},this.rawOutput=function(t){const[e,i]=n.parseId(t);return this.lockName(i),this.setup(e,(function(t,n){let e;Object.defineProperty(t,i,{get:function(){return e},set:function(t){n.html(e=t)},enumerable:!0})}))},this.input=function(t){const[e,i]=n.parseId(t);return this.lockName(i),this.setup(e,(function(t,n){Object.defineProperty(t,i,{get:function(){return n.val()},set:function(t){n.val(t)},enumerable:!0})}))},this.click=function(t,n){return this.setup(t,(function(t,e){const i=c(t,n);e.on("click",(function(t){return i(t),!1}))}))},this.toggle=function(t,n,e){return this.setup(t,(function(t,i){const o=c(t,n),r=c(t,e);let s=!1;i.on("click",(function(t){return 1==(s^=!0)?o(t):r(t),!1}))}))},this.stickyClick=function(t,n,e){return this.lockName(n,"stickyClick"),this.setup(t,(function(t,i){const o=c(t,e);i.on("click",(function(e){return t[n]||(t[n]=!0,o(e)),!1}))}))},this.element=function(t){const[e,i]=n.parseId(t);return this.lockName(i),this.addArgument(i,{forbidden:1}),this.setup(e,(function(t,n){t[i]=n}))},this.on=function(t,n,e){return this.setup(n,(function(n,i){const o=c(n,e);i.on(t,o)}))},this.upload=function(t,e){const[i,o]=n.parseId(t);return this.lockName(o),this.addArgument(o,{forbidden:1}),this.setup(i,(function(t,i){t[o]=function(o){let r=n.uploadFile(i[0].files[0],e);return o&&(r=r.then(o.bind(t))),r}}))},this._init={},this.def=function(t,n){return this.lockName(t),"function"==typeof n&&(o[t]=!0),this._init[t]=function(){return n},this},this.init=function(t,n){return this.lockName(t),this._init[t]=n,this},this.initArray=function(t,n=[]){return this.init(t,()=>[...n])},this.initObject=function(t,n={}){return this.init(t,()=>({...n}))},this.stickyState=function(t,i,r){const s=n.stickySM(i,{origin:t+" at "+e,initial:r});return o[t]=!0,this.init(t,()=>s.run())},this._onAttach=[],this.onAttach=function(t){return this._onAttach.push(t),this};const a={onRemove:[]};for(let t in a)this[t]=function(n){return a[t].push(n),this};function l(t,n){const e={};!function t(n,e){e(n);for(let i=n.firstChild;null!==i;i=i.nextSibling)1===i.nodeType&&t(i,e)}(t,t=>{for(let i of t.classList)if(void 0!==n[i]){if(e[i])throw new Error("Duplicate element with class "+i);e[i]=t}});for(let t in n)e[t]||i("Failed to locate class "+t);return e}this.checkElement=function(t,n="address"){void 0===t&&i("Cannot "+n+" a null element");let e="";return"string"==typeof t&&(e=" $("+t+")",t=window.$(t)),t instanceof window.$||i("Cannot "+n+" a non-$ object"),t.length||i("Cannot "+n+" a missing element"+e),t.length>1&&i("Cannot "+n+" an ambiguous element"+e),t.first()},this.attach=function(t,e={}){t=this.checkElement(t,"attach to");const r=this,f=new n.Bound;f.container=t;for(let t in a)f["_"+t]=[].concat(a[t]),f[t]=function(n){return f["_"+t].push(n),f};f.element={},f.appendTo=function(t){return(t=r.checkElement(t,"append to")).append(f.container),f},f.remove=function(){for(let t of f._onRemove)t.bind(f)();f.container.remove()};const d=l(t[0],this._wanted);f.element={};for(let t in d)f.element[this._wanted[t]]=window.$(d[t]);for(let t of r._setup)t[1](f,f.element[t[0]]);for(let t in r._init)!o[t]&&t in e||(f[t]=r._init[t].apply(f,[e]));for(let t in e)s[t]||i("unknown argument "+t),u[t]&&(o[t]?f[t](e[t]):f[t]=e[t]);for(let t in r._onAttach)c(f,r._onAttach[t])(e);return f},this.appendTo=function(t,n){return this.instantiate(n).appendTo(t)},this.instantiate=function(t){this._master||i("Trying to instantiate with an empty html()");const n=window.$(this._master.cloneNode(!0));return this.attach(n,t)}}return n.Bound=function(){},n.prefix="jrna-",n.documentTitle=function(...t){const n={};Object.defineProperty(n,"update",{value:function(){return window.document.title=t.join(""),n}});for(let e in t)Object.defineProperty(n,e,{get:function(){return t[e]},set:function(n){t[e]=n,this.update()},enumerable:!0});return Object.defineProperty(n,"length",{value:t.length}),n},n.upload=function(t={}){const e=window.document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("style","display: none"),new Promise(i=>{e.oninput=function(){n.uploadFile(this.files[0],t.type).then(t=>{e.remove(),i(t)})},window.document.body.appendChild(e),e.click()})},n.uploadFile=function(t,n){const e={text:"readAsText",raw:"readAsBinaryString",url:"readAsDataUrl"}[n||"text"];if(!e)throw new Error("uploadFile(): type must be 'text'(default), 'raw', or 'url'");const i=new window.FileReader;return new Promise((function(n){i.onload=function(){let e={content:i.result,info:t};for(let n in t)e[n]=t[n];n(e)},i[e](t)}))},n.download=function(t,n,e){e||(e="application/octet-stream");const i="data:"+e+","+encodeURIComponent(n),o=window.document.createElement("a");o.setAttribute("href",i),o.setAttribute("download",t),window.document.body.appendChild(o),o.click(),o.remove()},n.backend=function(t={}){const n=t.url;if(!n)throw new Error("jRna.backend: 'url' parameter is required");const e=(t.method||"POST").toUpperCase();let i,o,r;return i="application/json",o=JSON.parse,r=JSON.stringify,function(t){return new Promise((function(i){const s=new XMLHttpRequest;s.addEventListener("load",(function(){const t=o(this.responseText);i(t)})),s.open(e,n+""),s.setRequestHeader("Content-Type","application/json"),s.send(r(t))}))}},n.stickySM=function(n,e){const i=e.origin||"- jRna.stickySM@"+t(1);if(void 0!==e.initial&&!n[e.initial])throw new Error("Illegal initial state: "+e.initial+" "+i);return{run:function(){let t=e.initial;return function(e){if(void 0===e)return t;if(e!==t){const o=n[e];if(!o)throw new Error("Illegal state switch "+t+"->"+e+" "+i);o.apply(this,[t,e]),t=e}return this}}}},n.parseId=function(t,n={}){let e;if(Array.isArray(t)){if(t.length>2)throw new Error("jRna receptor must be a string or 2-element array");e=[].concat(t)}else e=[t];if("string"!=typeof e[0]&&"number"!=typeof e[0])throw new Error("jRna receptor must be a string or 2-element array");return void 0!==e[1]||n.skipMissing||(e[1]=e[0]),e},n}();"undefined"!=typeof window&&(window.jRna=jRna),"undefined"!=typeof module&&(module.exports=jRna);
Success
