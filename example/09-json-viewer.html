<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>JSON viewer - jRna examples</title>
    <script lang="javascript" src="3rd-party/jquery.js"></script>
    <script lang="javascript" src="../lib/jRna.js"></script>
    <script lang="javascript" id="description">
        const descr = {"title":"JSON viewer - jRna examples"}
    </script>
    <script lang="javascript">
        window.onerror = function(msg) {
            document.getElementById("error").innerHTML += '<div>'+msg+'</div>';
        };
    </script>
    <style>
        .object {
            padding-left: 2em;
        }
        .jrna-value {
            color: blue;
        }
    </style>
</head>
<body>
    <div id="error" style="color: red"></div>
    <h1>JSON viewer - jRna examples</h1>

    <!-- initial node to attach to -->
    <div id="root">
        <div id="upload">
            <input type="file" class="jrna-file">
        </div>
        <div id="container">
        </div>
    </div>

    <!-- the script is here -->
    <script lang="javascript" id="main">
        "use strict";

        const node = {};

        node.undefined = node.null = new jRna()
            .html('<span class="null"><span class="jrna-value">null</span></span>')
            .args('value'); // unused
        node.number = new jRna()
            .html('<span class="number"><span class="jrna-value"></span></span>')
            .output('value')
            .args('value');
        node.string = new jRna()
            .html('<span class="string">\'<span class="jrna-value"></span>\'</span>')
            .output('value')
            .args('value');
        // TODO array
        const keyvalue = new jRna()
            .html('<div><span class="jrna-key"></span>: </div>')
            .args('key', 'value')
            .output('key')
            .on_attach(function() {
                const nodetype = typeof this.value;

                node[nodetype].append_to( this.container, { value : this.value });
            });

        node.object = new jRna()
            .html('<div class="object"><div class="jrna-content"></div></div>')
            .args('value')
            .element('content')
            .on_attach(function() {
                // TODO sort
                for (let key in this.value) {
                    keyvalue.append_to(this.content, { key: key, value: this.value[key]} );
                };
            });

        let last;
        const upload = new jRna()
            .upload('file')
            .on('file', 'change', function() {
                this.file( function(raw) {
                    console.log(raw);
                    const obj = JSON.parse(raw.content);
                    if(last)
                        last.remove();
                    last = keyvalue.append_to('#container', { value : obj })
                });
            })
            .attach('#upload');
    </script>

    <!-- describe how to use the page, if needed -->
    <div id="usage">
    </div>
</body>
</html>
